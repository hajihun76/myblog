{% extends "blog_base/base_with_navbar.html" %}
{% load static %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'community/css/navbar_override.css' %}">
{% endblock extra_head %}

{% block title %}자유게시판{% endblock title %}

{% block content %}
<!-- ✅ Bootstrap 5 CDN (한번만 로드되게 상위 템플릿에 넣는 것이 이상적입니다) -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- ✅ 커뮤니티 게시판 컨테이너 -->
<main class="container-lg py-5" style="max-width: 960px;">

  <!-- ✅ 게시판 헤더 -->
  <div class="d-flex justify-content-between align-items-center mb-4 border-bottom pb-2">
    <h2 class="fw-bold text-light mb-0">자유게시판</h2>
    <form method="get" class="mb-3 d-flex justify-content-end">
      <input type="text" name="q" value="{{ request.GET.q }}" class="form-control w-100" placeholder="검색어 입력">
      <button type="submit" class="btn btn-outline-light ms-2">검색</button>
    </form>
    <a href="{% url 'community_create' %}" class="btn btn-light btn-sm text-dark">
      ✍ 글쓰기
    </a>       
  </div>

  <!-- ✅ 테이블 감싸는 카드 박스 -->
  <div class="shadow-sm rounded bg-white overflow-hidden border">
    <table class="table table-hover align-middle mb-0 text-center">
      <thead class="table-light">
        <tr>
          <th style="width: 5%;">#</th>
          <th class="text-start">제목</th>
          <th style="width: 20%;">작성자</th>
          <th style="width: 20%;">작성일</th>
        </tr>
      </thead>
      <tbody>
        {% for post in posts %}
        <tr {% if post.is_notice %}class="table-warning"{% endif %}>
          <td>{{ forloop.counter }}</td>
          <td class="text-start">
            <a href="{% url 'community_detail' post.id %}" class="text-dark text-decoration-none fw-semibold">

              {% if post.is_notice %}
                <span class="badge bg-warning text-dark me-1">공지</span>
              {% endif %}

              {{ post.title }}
            </a>
          </td>
          <td>{{ post.author.nickname }}</td>
          <td>{{ post.created_at|date:"Y.m.d H:i" }}</td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="4" class="py-4 text-muted">아직 게시글이 없습니다.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- ✅ 페이지네이션 -->
  {% if is_paginated %}
  <nav class="mt-4" aria-label="페이지 이동">
    <ul class="pagination justify-content-center mb-0">
      {% if page_obj.has_previous %}
        <li class="page-item">
          <a class="page-link" href="?page={{ page_obj.previous_page_number }}" aria-label="이전">
            &laquo;
          </a>
        </li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">&laquo;</span></li>
      {% endif %}

      {% for num in paginator.page_range %}
        <li class="page-item {% if page_obj.number == num %}active{% endif %}">
          <a class="page-link" href="?page={{ num }}">{{ num }}</a>
        </li>
      {% endfor %}

      {% if page_obj.has_next %}
        <li class="page-item">
          <a class="page-link" href="?page={{ page_obj.next_page_number }}" aria-label="다음">
            &raquo;
          </a>
        </li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">&raquo;</span></li>
      {% endif %}
    </ul>
  </nav>
  {% endif %}

</main>
{% endblock content %}
