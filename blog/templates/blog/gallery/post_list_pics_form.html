{% extends "blog_base/base_with_navbar.html" %}
{% load static %}
{% load widget_tweaks %}

{% block title %}새 이미지 작성{% endblock title %}

{% block content %}
<main class="site-body">
  <form class="review-form max-content-width" method="post" autocomplete="off" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="content">
      {{ form.content|add_class:"cp-input"|add_error_class:"error"|attr:"placeholder:사진에 대한 설명이나 감상을 적어주세요." }}
      {% for error in form.content.errors %}
        <div class="error-message">{{ error }}</div>
      {% endfor %}
    </div>
    <div class="file">
      <div class="file-content">
        <div class="thumb_js">
          {% if object.image %}
          <img
            src="{{ object.image.url }}"
            alt="현재 이미지"
            class="preview-img"
            style="
              display: block;
              margin-bottom: 8px;
              max-width:120px;
              border:1px solid #ccc;
              border-radius:4px;
              object-fit:cover;
            "
          >
        {% endif %}
          <label for="id_image"></label><br>
          {{ form.image|add_class:"cp-input file-input"|attr:"id:id_image"|attr:"accept:image/*" }}
          {% for error in form.image.errors %}
            <div class="error-message">{{ error }}</div>
          {% endfor %}
          <img id="image-preview" src="" alt="미리보기" style="display:none; margin-top:8px; max-width:120px; border:1px solid #ccc; border-radius:4px; object-fit:cover;">
        </div>
      </div>
    </div>
    <div class="buttons">
      <a 
        class="cp-button secondary cancel" 
        href="{% url 'post_list_detail' post_list.id %}"
      >
        취소
      </a>
      <button class="cp-button submit" type="submit">완료</button>
    </div>
  </form>
</main>
{% endblock content %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const fileInput = document.getElementById('id_image');
  const previewImg = document.getElementById('image-preview');
  if (!fileInput || !previewImg) return;

  fileInput.addEventListener('change', function() {
    const file = this.files[0];
    if (!file) {
      previewImg.style.display = 'none';
      previewImg.src = '';
      return;
    }
    const url = URL.createObjectURL(file);
    previewImg.src = url;
    previewImg.style.display = 'block';
    previewImg.onload = () => URL.revokeObjectURL(url);
  });
});
</script>
{% endblock extra_js %}
